<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Grouping - LambdaORM Wiki</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">LambdaORM Wiki</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Î»ORM "We don't reinvent the wheel, we improve it"</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Features/" class="nav-link">Features</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Sidebar/" class="nav-link">Sidebar</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../Usage/" class="nav-link">Usage</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../function_functions/" class="nav-link">Function functions</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../operator_operators/" class="nav-link">Operator operators</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Queries <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../Expression/" class="dropdown-item">Lambda expressions</a>
</li>
                                    
<li>
    <a href="../../Metadata/" class="dropdown-item">Metadata</a>
</li>
                                    
<li>
    <a href="../../Query-Language/" class="dropdown-item">Query Language</a>
</li>
                                    
<li>
    <a href="../../Repository/" class="dropdown-item">Repositories</a>
</li>
                                    
<li>
    <a href="../../Transaction/" class="dropdown-item">Transaction</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Dml</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../dml/BulkInsert/" class="dropdown-item">BulkInsert</a>
</li>
            
<li>
    <a href="../../dml/Delete/" class="dropdown-item">Delete</a>
</li>
            
<li>
    <a href="../../dml/Insert/" class="dropdown-item">Insert</a>
</li>
            
<li>
    <a href="../../dml/Update/" class="dropdown-item">Update</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Dql</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Grouping</a>
</li>
            
<li>
    <a href="../Include/" class="dropdown-item">Include</a>
</li>
            
<li>
    <a href="../Join/" class="dropdown-item">Join</a>
</li>
            
<li>
    <a href="../Select/" class="dropdown-item">Select</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">operatorsAndFunctions</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../operatorsAndFunctions/Bitwise/" class="dropdown-item">Bitwise</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Comparison/" class="dropdown-item">Comparison</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Datetime/" class="dropdown-item">Datetime</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Group/" class="dropdown-item">Group</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Logical/" class="dropdown-item">Logical</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Nullable/" class="dropdown-item">Nullable</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Numeric/" class="dropdown-item">Numeric</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/Sort/" class="dropdown-item">Sort</a>
</li>
            
<li>
    <a href="../../operatorsAndFunctions/String/" class="dropdown-item">String</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Schema <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../schema/Schema-Use/" class="dropdown-item">Schema Use</a>
</li>
                                    
<li>
    <a href="../../../schema/Schema/" class="dropdown-item">Schema</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Definition</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../schema/Definition/SchemaDefinition-Composite/" class="dropdown-item">Composite Entity</a>
</li>
            
<li>
    <a href="../../../schema/Definition/SchemaDefinition-EnvironmentVariables/" class="dropdown-item">Environment Variables on Schema</a>
</li>
            
<li>
    <a href="../../../schema/Definition/SchemaDefinition-Expressions/" class="dropdown-item">Expressions on Schema</a>
</li>
            
<li>
    <a href="../../../schema/Definition/SchemaDefinition/" class="dropdown-item">Definition</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Examples</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../schema/Examples/SchemaExample-Basic/" class="dropdown-item">Basic Schema Example</a>
</li>
            
<li>
    <a href="../../../schema/Examples/SchemaExample-Composite/" class="dropdown-item">Composite Entity</a>
</li>
            
<li>
    <a href="../../../schema/Examples/SchemaExample-Extend/" class="dropdown-item">Extend</a>
</li>
            
<li>
    <a href="../../../schema/Examples/SchemaExample-Listener/" class="dropdown-item">Listener on Schema</a>
</li>
            
<li>
    <a href="../../../schema/Examples/SchemaExample-MultiplesStages/" class="dropdown-item">Multiples Stages</a>
</li>
            
<li>
    <a href="../../../schema/Examples/SchemaExample-StageMultiplesSources/" class="dropdown-item">Stage related multiples Sources</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Synchronization</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../schema/Synchronization/SchemaSynchronization-Fetch/" class="dropdown-item">Fetch</a>
</li>
            
<li>
    <a href="../../../schema/Synchronization/SchemaSynchronization-Incorporate/" class="dropdown-item">Incorporate</a>
</li>
            
<li>
    <a href="../../../schema/Synchronization/SchemaSynchronization-Introspect/" class="dropdown-item">Introspect</a>
</li>
            
<li>
    <a href="../../../schema/Synchronization/SchemaSynchronization-Pull/" class="dropdown-item">Pull</a>
</li>
            
<li>
    <a href="../../../schema/Synchronization/SchemaSynchronization-Push/" class="dropdown-item">Push</a>
</li>
            
<li>
    <a href="../../../schema/Synchronization/SchemaSynchronization/" class="dropdown-item">Synchronization</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../dml/Update/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Include/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-light">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#grouping" class="nav-link">Grouping</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#grouping-functions" class="nav-link">Grouping Functions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#grouping-by-sum-with-order-and-filter" class="nav-link">Grouping by sum with order and filter</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#grouping-and-having" class="nav-link">Grouping and Having</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#code-example" class="nav-link">Code example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="grouping">Grouping</h1>
<p>In the case of grouping, it is not necessary to define it explicitly, since it is deduced when one of the grouping functions is used. \
The fields by which they are grouped are deduced by which they are contained with some of the grouping functions.</p>
<h2 id="grouping-functions">Grouping Functions</h2>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>avg</td>
<td>Calculates the average of the specified columns in a set of rows</td>
</tr>
<tr>
<td>count</td>
<td>Calculating the number of rows in a set.</td>
</tr>
<tr>
<td>first</td>
<td>Returns the first value of the selected column</td>
</tr>
<tr>
<td>last</td>
<td>Returns the last value of the selected column.</td>
</tr>
<tr>
<td>max</td>
<td>Calculating the maximum.</td>
</tr>
<tr>
<td>min</td>
<td>Calculating the minimum.</td>
</tr>
<tr>
<td>sum</td>
<td>Calculating the sum.</td>
</tr>
</tbody>
</table>
<h2 id="grouping-by-sum-with-order-and-filter">Grouping by sum with order and filter</h2>
<p>Filters order details based on customer name
Maps the results to get the order date and the total calculated as the sum of (quantity * unit price)
Orders the results in descending order by total</p>
<p><strong>Lambda:</strong></p>
<pre><code class="language-Typescript">OrderDetails
    .filter(p =&gt; p.order.customer.name == customerName)
    .map(p =&gt; ({ order: p.order.orderDate, total: sum(p.quantity * p.unitPrice) }))
    .sort(p =&gt; desc(p.total))
</code></pre>
<p><strong>SQL Result:</strong></p>
<pre><code class="language-sql">-- Selects order date and calculates the sum of (quantity * unit price) as 'total'
-- Performs inner join with Orders and Customers table to get additional customer information
-- Filters the results based on customer company name
-- Groups the results by order date
-- Orders the results in descending order by total
SELECT o1.OrderDate AS `order`, SUM(o.Quantity * o.UnitPrice) AS `total` 
FROM `Order Details` o 
INNER JOIN Orders o1 ON o1.OrderID = o.OrderID 
INNER JOIN Customers c ON c.CustomerID = o1.CustomerID 
WHERE c.CompanyName = ? 
GROUP BY o1.OrderDate 
ORDER BY `total` desc 
</code></pre>
<h2 id="grouping-and-having">Grouping and Having</h2>
<p>Filters products based on price and supplier country, or stock quantity
Filters the results based on maximum price
Maps the results to get the product category and maximum price
Sorts the results in descending order by maximum price</p>
<p><strong>Lambda:</strong></p>
<pre><code class="language-Typescript">Products
    .filter(p =&gt; (p.price &gt; 5 &amp;&amp; p.supplier.country == country) || (p.inStock &lt; 3))
    .having(p =&gt; max(p.price) &gt; 50)
    .map(p =&gt; ({ category: p.category.name, largestPrice: max(p.price) }))
    .sort(p =&gt; desc(p.largestPrice))
</code></pre>
<p><strong>SQL Result:</strong></p>
<pre><code class="language-sql">-- Selects product category and calculates the maximum price as 'largestPrice'
-- Performs inner join with Suppliers and Categories tables to get additional product information
-- Filters the results based on price and supplier country, or stock quantity
-- Groups the results by product category
-- Filters the results based on maximum price
-- Orders the results in descending order by maximum price
SELECT c.CategoryName AS `category`, MAX(p.UnitPrice) AS `largestPrice` 
FROM Products p 
INNER JOIN Suppliers s ON s.SupplierID = p.SupplierID 
INNER JOIN Categories c ON c.CategoryID = p.CategoryID 
WHERE ((p.UnitPrice &gt; 5 AND s.Country = ?) OR p.UnitsInStock &lt; 3) 
GROUP BY c.CategoryName 
HAVING MAX(p.UnitPrice) &gt; 50 
ORDER BY `largestPrice` desc 
</code></pre>
<h2 id="code-example">Code example</h2>
<pre><code class="language-Typescript">import { orm } from '../../lib'
import { Products } from '../northwind/model/__model'
(async () =&gt; {
    try {       
        await orm.init('./config/northwind.yaml')
        // Defining a query function that accepts a country parameter
        // Filtering products based on price and supplier country, or stock quantity
        // Filtering the results based on maximum price
        // Mapping the results to get the product category and maximum price
        // Sorting the results in descending order by maximum price     
        const query = (country:string) =&gt; Products                      
                        .filter(p =&gt; (p.price &gt; 5 &amp;&amp; p.supplier.country == country) || (p.inStock &lt; 3))                     
                        .having(p =&gt; max(p.price) &gt; 50)                     
                        .map(p =&gt; ({ category: p.category.name, largestPrice: max(p.price) }))                      
                        .sort(p =&gt; desc(p.largestPrice))
        const result = await orm.execute(query, {country:'ARG'})
        console.log(JSON.stringify(result, null, 2))
    } catch (error:any) {
        console.error(error.stack)
    } finally {
        // Ending the ORM connection
        await orm.end()
    }
})()
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
